package cat;

import javax.swing.SwingUtilities;

// ==========================================
// ä¸»ç¨‹å¼ (Entry Point)
// ==========================================
public class CatMVC {
    public static void main(String[] args) {
        System.out.println("å•Ÿå‹• MVC è²“å’ªå¥åº·æª¢æ¸¬ç³»çµ±...");
        SwingUtilities.invokeLater(() -> {
            // åˆå§‹åŒ– M, V, C
            CatModel model = new CatModel();
            CatView view = new CatView();
            CatController controller = new CatController(model, view);
            
            // é¡¯ç¤ºè¦–çª—
            view.setVisible(true);
        });
    }
}

//================================================================================================
//MVCçš„view
package cat;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionListener;
import java.awt.print.PrinterException; // å¼•å…¥åˆ—å°ä¾‹å¤–è™•ç†

public class CatView extends JFrame {
    // UI å…ƒä»¶
    private JComboBox<String> breedBox;
    private JTextField ageField;
    private JTextField weightField;
    private JComboBox<String> appetiteBox;
    private JRadioButton activeHigh, activeNormal, activeLow;
    private JComboBox<String> activeTimeBox;
    private JCheckBox vomitCheck, itchCheck, coughCheck;
    private JTextArea resultArea;
    private JLabel photoLabel;
    private JLabel timeLabel;
    
    // æŒ‰éˆ•ç¾¤
    private JButton btnAnalyze;
    private JButton btnClear;
    private JButton btnSave;
    private JButton btnPrint; // [æ–°å¢]
    private JButton btnAbout;
    private JButton btnClose; // [æ–°å¢]

    public CatView() {
        setTitle("è²“å’ªå¥åº·æª¢æ¸¬ç³»çµ± (MVCç‰ˆ)");
        setSize(950, 900);
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLocationRelativeTo(null);
        setLayout(new BorderLayout(10, 10));

        initComponents();
    }

    private void initComponents() {
        // --- é ‚éƒ¨ ---
        JPanel topPanel = new JPanel(new BorderLayout());
        JLabel titleLabel = new JLabel("ğŸ± è²“å’ªå¥åº·æª¢æ¸¬ç«™", SwingConstants.CENTER);
        titleLabel.setFont(new Font("Dialog", Font.BOLD, 24));
        titleLabel.setBorder(BorderFactory.createEmptyBorder(15, 0, 5, 0));
        titleLabel.setForeground(new Color(60, 60, 60));
        
        timeLabel = new JLabel("è¼‰å…¥æ™‚é–“ä¸­...", SwingConstants.CENTER);
        timeLabel.setFont(new Font("Monospaced", Font.BOLD, 16));
        timeLabel.setForeground(new Color(0, 102, 204));
        timeLabel.setBorder(BorderFactory.createEmptyBorder(0, 0, 15, 0));
        
        topPanel.add(titleLabel, BorderLayout.CENTER);
        topPanel.add(timeLabel, BorderLayout.SOUTH);
        add(topPanel, BorderLayout.NORTH);

        // --- ä¸­å¤®è¡¨å–® ---
        JPanel formPanel = new JPanel(new GridBagLayout());
        formPanel.setBorder(BorderFactory.createEmptyBorder(10, 20, 10, 20));
        GridBagConstraints gbc = new GridBagConstraints();
        gbc.insets = new Insets(10, 10, 10, 10);
        gbc.fill = GridBagConstraints.HORIZONTAL;
        
        Font labelFont = new Font("SansSerif", Font.PLAIN, 16);
        Font inputFont = new Font("SansSerif", Font.PLAIN, 14);

        // 1. å“ç¨®
        addFormRow(formPanel, gbc, 0, "è²“å’ªå“ç¨®ï¼š", labelFont);
        String[] breeds = {"æ··ç¨®è²“ (ç±³å…‹æ–¯)", "ç¾åœ‹çŸ­æ¯›è²“", "è‹±åœ‹çŸ­æ¯›è²“", "æ³¢æ–¯è²“", "æš¹ç¾…è²“", "å¸ƒå¶è²“", "è˜‡æ ¼è˜­æŠ˜è€³è²“", "å…¶ä»–"};
        breedBox = new JComboBox<>(breeds);
        breedBox.setFont(inputFont);
        formPanel.add(breedBox, gbc);

        // 2. å¹´é½¡
        addFormRow(formPanel, gbc, 1, "å¹´é½¡ (æ­²)ï¼š", labelFont);
        ageField = new JTextField(15);
        ageField.setFont(inputFont);
        formPanel.add(ageField, gbc);

        // 3. é«”é‡
        addFormRow(formPanel, gbc, 2, "é«”é‡ (kg)ï¼š", labelFont);
        weightField = new JTextField(15);
        weightField.setFont(inputFont);
        formPanel.add(weightField, gbc);

        // 4. é£Ÿæ…¾
        addFormRow(formPanel, gbc, 3, "é£Ÿæ…¾ç‹€æ³ï¼š", labelFont);
        String[] appetites = {"æ­£å¸¸", "é£Ÿæ…¾æ—ºç››", "é£Ÿæ…¾ä¸ä½³"};
        appetiteBox = new JComboBox<>(appetites);
        appetiteBox.setFont(inputFont);
        formPanel.add(appetiteBox, gbc);

        // 5. æ´»å‹•å¼·åº¦
        addFormRow(formPanel, gbc, 4, "æ´»å‹•å¼·åº¦ï¼š", labelFont);
        JPanel radioPanel = new JPanel(new FlowLayout(FlowLayout.LEFT, 0, 0));
        activeHigh = new JRadioButton("é«˜");
        activeNormal = new JRadioButton("ä¸­", true);
        activeLow = new JRadioButton("ä½");
        activeHigh.setFont(inputFont); activeNormal.setFont(inputFont); activeLow.setFont(inputFont);
        ButtonGroup group = new ButtonGroup();
        group.add(activeHigh); group.add(activeNormal); group.add(activeLow);
        radioPanel.add(activeHigh); radioPanel.add(activeNormal); radioPanel.add(activeLow);
        JLabel noteLabel = new JLabel("(åƒè€ƒ: é«˜=æ„›è·‘é…·, ä¸­=å¶çˆ¾ç©, ä½=éƒ½åœ¨ç¡)");
        noteLabel.setFont(new Font("SansSerif", Font.PLAIN, 12));
        noteLabel.setForeground(Color.GRAY);
        noteLabel.setBorder(BorderFactory.createEmptyBorder(5, 5, 0, 0));
        radioPanel.add(noteLabel);
        formPanel.add(radioPanel, gbc);

        // 6. æ´»å‹•æ™‚é–“
        addFormRow(formPanel, gbc, 5, "æ´»å‹•æ™‚é–“ï¼š", labelFont);
        String[] timeRanges = {"1å°æ™‚ä»¥ä¸‹", "1~3å°æ™‚", "3~5å°æ™‚", "5å°æ™‚ä»¥ä¸Š"};
        activeTimeBox = new JComboBox<>(timeRanges);
        activeTimeBox.setFont(inputFont);
        formPanel.add(activeTimeBox, gbc);

        // 7. å…¶ä»–ç—‡ç‹€
        gbc.gridx = 0; gbc.gridy = 6; gbc.weightx = 0;
        gbc.anchor = GridBagConstraints.NORTHWEST;
        JLabel l7 = new JLabel("å…¶ä»–ç—‡ç‹€ï¼š");
        l7.setFont(labelFont);
        formPanel.add(l7, gbc);
        
        gbc.gridx = 1; gbc.weightx = 1.0;
        gbc.anchor = GridBagConstraints.CENTER;
        JPanel symptomPanel = new JPanel();
        symptomPanel.setLayout(new BoxLayout(symptomPanel, BoxLayout.Y_AXIS));
        vomitCheck = new JCheckBox("æœ‰å˜”åæˆ–æ‹‰è‚šå­æƒ…å½¢");
        itchCheck = new JCheckBox("é »ç¹æŠ“ç™¢æˆ–å±€éƒ¨è„«æ¯›");
        coughCheck = new JCheckBox("å‘¼å¸æ€¥ä¿ƒæˆ–å’³å—½");
        vomitCheck.setFont(inputFont); vomitCheck.setForeground(Color.RED);
        itchCheck.setFont(inputFont); itchCheck.setForeground(new Color(139, 69, 19));
        coughCheck.setFont(inputFont); coughCheck.setForeground(Color.RED);
        symptomPanel.add(vomitCheck); symptomPanel.add(itchCheck); symptomPanel.add(coughCheck);
        formPanel.add(symptomPanel, gbc);

        // åŠ å…¥æ²è»¸
        JScrollPane scrollPane = new JScrollPane(formPanel);
        scrollPane.setBorder(null);
        scrollPane.getVerticalScrollBar().setUnitIncrement(16);
        add(scrollPane, BorderLayout.CENTER);

        // --- å³å´ç…§ç‰‡å€ ---
        JPanel photoPanel = new JPanel(new BorderLayout());
        photoPanel.setPreferredSize(new Dimension(320, 0));
        photoPanel.setBorder(BorderFactory.createEmptyBorder(10, 0, 10, 10));
        photoLabel = new JLabel("è¼‰å…¥ä¸­...", SwingConstants.CENTER);
        photoLabel.setVerticalAlignment(SwingConstants.TOP); // é ä¸Šå°é½Š
        photoLabel.setBorder(BorderFactory.createLineBorder(Color.LIGHT_GRAY));
        photoLabel.setFont(new Font("Dialog", Font.PLAIN, 14));
        photoPanel.add(photoLabel, BorderLayout.CENTER);
        add(photoPanel, BorderLayout.EAST);

        // --- åº•éƒ¨æŒ‰éˆ•èˆ‡çµæœ ---
        JPanel bottomPanel = new JPanel(new BorderLayout());
        bottomPanel.setBorder(BorderFactory.createEmptyBorder(10, 20, 20, 20));
        
        // [é—œéµ] ä½¿ç”¨ 2åˆ—3è¡Œ çš„ GridLayout ä¾†æ”¾ 6 å€‹æŒ‰éˆ•
        JPanel buttonPanel = new JPanel(new GridLayout(2, 3, 10, 10));
        
        btnAnalyze = new JButton("é–‹å§‹åˆ†æ");
        btnAnalyze.setBackground(new Color(70, 130, 180)); btnAnalyze.setForeground(Color.WHITE);
        btnAnalyze.setFont(new Font("Dialog", Font.BOLD, 16));
        
        btnClear = new JButton("æ¸…é™¤é‡å¡«");
        btnClear.setBackground(new Color(220, 20, 60)); btnClear.setForeground(Color.WHITE);
        btnClear.setFont(new Font("Dialog", Font.BOLD, 16));
        
        btnSave = new JButton("å„²å­˜è¨˜éŒ„");
        btnSave.setBackground(new Color(34, 139, 34)); btnSave.setForeground(Color.WHITE);
        btnSave.setFont(new Font("Dialog", Font.BOLD, 16));
        
        // [æ–°å¢] åˆ—å°æŒ‰éˆ•
        btnPrint = new JButton("åˆ—å°çµæœ");
        btnPrint.setBackground(new Color(100, 149, 237)); // çŸ¢è»ŠèŠè—
        btnPrint.setForeground(Color.WHITE);
        btnPrint.setFont(new Font("Dialog", Font.BOLD, 16));

        btnAbout = new JButton("é—œæ–¼ç³»çµ±");
        btnAbout.setBackground(new Color(255, 165, 0)); btnAbout.setForeground(Color.WHITE);
        btnAbout.setFont(new Font("Dialog", Font.BOLD, 16));

        // [æ–°å¢] é—œé–‰æŒ‰éˆ•
        btnClose = new JButton("é—œé–‰ç³»çµ±");
        btnClose.setBackground(new Color(105, 105, 105)); // æ·±ç°è‰²
        btnClose.setForeground(Color.WHITE);
        btnClose.setFont(new Font("Dialog", Font.BOLD, 16));

        // ä¾åºåŠ å…¥æŒ‰éˆ•
        buttonPanel.add(btnAnalyze); 
        buttonPanel.add(btnClear);
        buttonPanel.add(btnSave);
        buttonPanel.add(btnPrint);  // æ–°å¢
        buttonPanel.add(btnAbout);
        buttonPanel.add(btnClose);  // æ–°å¢
        
        bottomPanel.add(buttonPanel, BorderLayout.NORTH);

        resultArea = new JTextArea();
        resultArea.setEditable(false);
        resultArea.setFont(new Font("Monospaced", Font.PLAIN, 14));
        resultArea.setBorder(BorderFactory.createTitledBorder("æª¢æ¸¬çµæœ"));
        resultArea.setPreferredSize(new Dimension(100, 250));
        bottomPanel.add(new JScrollPane(resultArea), BorderLayout.CENTER);

        add(bottomPanel, BorderLayout.SOUTH);
    }

    // è¼”åŠ©æ–¹æ³•ï¼šç°¡åŒ– GridBagLayout è¨­å®š
    private void addFormRow(JPanel p, GridBagConstraints gbc, int row, String text, Font font) {
        gbc.gridx = 0; gbc.gridy = row; gbc.weightx = 0;
        JLabel l = new JLabel(text);
        l.setFont(font);
        p.add(l, gbc);
        gbc.gridx = 1; gbc.weightx = 1.0;
    }

    // --- Getter æ–¹æ³• ---
    public String getSelectedBreed() { return (String) breedBox.getSelectedItem(); }
    public String getAge() { return ageField.getText().trim(); }
    public String getWeight() { return weightField.getText().trim(); }
    public String getAppetite() { return (String) appetiteBox.getSelectedItem(); }
    public String getActiveTime() { return (String) activeTimeBox.getSelectedItem(); }
    public boolean isLowActive() { return activeLow.isSelected(); }
    public boolean hasVomit() { return vomitCheck.isSelected(); }
    public boolean hasItch() { return itchCheck.isSelected(); }
    public boolean hasCough() { return coughCheck.isSelected(); }

    // --- Setter æ–¹æ³• ---
    public void setPhoto(Icon icon) { photoLabel.setIcon(icon); photoLabel.setText(""); }
    public void setPhotoText(String text) { photoLabel.setIcon(null); photoLabel.setText(text); }
    public void setTimeText(String text) { timeLabel.setText(text); }
    public void setResultText(String text, boolean isUrgent) {
        resultArea.setText(text);
        resultArea.setForeground(isUrgent ? Color.RED : Color.BLACK);
    }
    public void clearForm() {
        breedBox.setSelectedIndex(0);
        ageField.setText("");
        weightField.setText("");
        appetiteBox.setSelectedIndex(0);
        activeNormal.setSelected(true);
        activeTimeBox.setSelectedIndex(0);
        vomitCheck.setSelected(false);
        itchCheck.setSelected(false);
        coughCheck.setSelected(false);
        resultArea.setText("");
        resultArea.setForeground(Color.BLACK);
    }
    public void showMessage(String msg) {
        JOptionPane.showMessageDialog(this, msg);
    }
    
    // [æ–°å¢] åŸ·è¡Œåˆ—å°åŠŸèƒ½
    public void printReport() {
        try {
            boolean complete = resultArea.print();
            if (complete) {
                JOptionPane.showMessageDialog(this, "åˆ—å°å®Œæˆï¼", "è¨Šæ¯", JOptionPane.INFORMATION_MESSAGE);
            }
        } catch (PrinterException pe) {
            JOptionPane.showMessageDialog(this, "åˆ—å°å¤±æ•—: " + pe.getMessage(), "éŒ¯èª¤", JOptionPane.ERROR_MESSAGE);
        }
    }

    // --- ç›£è½å™¨è¨»å†Šæ–¹æ³• ---
    public void addAnalyzeListener(ActionListener l) { btnAnalyze.addActionListener(l); }
    public void addClearListener(ActionListener l) { btnClear.addActionListener(l); }
    public void addSaveListener(ActionListener l) { btnSave.addActionListener(l); }
    public void addAboutListener(ActionListener l) { btnAbout.addActionListener(l); }
    // [æ–°å¢] è¨»å†Šæ–°çš„ç›£è½å™¨
    public void addPrintListener(ActionListener l) { btnPrint.addActionListener(l); }
    public void addCloseListener(ActionListener l) { btnClose.addActionListener(l); }
    public void addBreedListener(ActionListener l) { breedBox.addActionListener(l); }
}